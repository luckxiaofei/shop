{"remainingRequest":"/Users/luck/shop/admin_web/node_modules/babel-loader/lib/index.js!/Users/luck/shop/admin_web/node_modules/eslint-loader/index.js??ref--13-0!/Users/luck/shop/admin_web/src/store/modules/permission.js","dependencies":[{"path":"/Users/luck/shop/admin_web/src/store/modules/permission.js","mtime":1585976621953},{"path":"/Users/luck/shop/admin_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/luck/shop/admin_web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/luck/shop/admin_web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/luck/shop/admin_web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"/Users/luck/shop/admin_web/node_modules/@babel/runtime-corejs2/helpers/objectSpread2\"));\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nvar _router = require(\"@/router\");\n\n/**\n * 通过meta.perms判断是否与当前用户权限匹配\n * @param perms\n * @param route\n */\nfunction hasPermission(perms, route) {\n  if (route.meta && route.meta.perms) {\n    return perms.some(function (perm) {\n      return route.meta.perms.includes(perm);\n    });\n  } else {\n    return true;\n  }\n}\n/**\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\n * @param routes asyncRouterMap\n * @param perms\n */\n\n\nfunction filterAsyncRouter(routes, perms) {\n  var res = [];\n  routes.forEach(function (route) {\n    var tmp = (0, _objectSpread2.default)({}, route);\n\n    if (tmp.children) {\n      tmp.children = filterAsyncRouter(tmp.children, perms);\n\n      if (tmp.children && tmp.children.length > 0) {\n        res.push(tmp);\n      }\n    } else {\n      if (hasPermission(perms, tmp)) {\n        res.push(tmp);\n      }\n    }\n  });\n  return res;\n}\n\nvar permission = {\n  state: {\n    routers: _router.constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: function SET_ROUTERS(state, routers) {\n      state.addRouters = routers;\n      state.routers = _router.constantRouterMap.concat(routers);\n    }\n  },\n  actions: {\n    GenerateRoutes: function GenerateRoutes(_ref, data) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve) {\n        var perms = data.perms;\n        var accessedRouters;\n\n        if (perms.includes('*')) {\n          accessedRouters = _router.asyncRouterMap;\n        } else {\n          accessedRouters = filterAsyncRouter(_router.asyncRouterMap, perms);\n        }\n\n        commit('SET_ROUTERS', accessedRouters);\n        resolve();\n      });\n    }\n  }\n};\nvar _default = permission;\nexports.default = _default;",null]}