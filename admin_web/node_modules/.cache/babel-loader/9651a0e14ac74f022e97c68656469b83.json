{"remainingRequest":"/Users/luck/shop/admin_web/node_modules/babel-loader/lib/index.js!/Users/luck/shop/admin_web/node_modules/eslint-loader/index.js??ref--13-0!/Users/luck/shop/admin_web/src/store/modules/user.js","dependencies":[{"path":"/Users/luck/shop/admin_web/src/store/modules/user.js","mtime":1585976621954},{"path":"/Users/luck/shop/admin_web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/luck/shop/admin_web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/luck/shop/admin_web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _login = require(\"@/api/login\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar user = {\n  state: {\n    user: '',\n    status: '',\n    code: '',\n    token: (0, _auth.getToken)(),\n    name: '',\n    avatar: '',\n    introduction: '',\n    roles: [],\n    perms: [],\n    setting: {\n      articlePlatform: []\n    }\n  },\n  mutations: {\n    SET_CODE: function SET_CODE(state, code) {\n      state.code = code;\n    },\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_INTRODUCTION: function SET_INTRODUCTION(state, introduction) {\n      state.introduction = introduction;\n    },\n    SET_SETTING: function SET_SETTING(state, setting) {\n      state.setting = setting;\n    },\n    SET_STATUS: function SET_STATUS(state, status) {\n      state.status = status;\n    },\n    SET_NAME: function SET_NAME(state, name) {\n      state.name = name;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_PERMS: function SET_PERMS(state, perms) {\n      state.perms = perms;\n    }\n  },\n  actions: {\n    // 用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      var username = userInfo.username.trim();\n      return new Promise(function (resolve, reject) {\n        (0, _login.loginByUsername)(username, userInfo.password).then(function (response) {\n          var token = response.data.data.token;\n          commit('SET_TOKEN', token);\n          (0, _auth.setToken)(token);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetUserInfo: function GetUserInfo(_ref2) {\n      var commit = _ref2.commit,\n          state = _ref2.state;\n      return new Promise(function (resolve, reject) {\n        (0, _login.getUserInfo)(state.token).then(function (response) {\n          var data = response.data.data;\n\n          if (data.perms && data.perms.length > 0) {\n            // 验证返回的perms是否是一个非空数组\n            commit('SET_PERMS', data.perms);\n          } else {\n            reject('getInfo: perms must be a non-null array !');\n          }\n\n          commit('SET_ROLES', data.roles);\n          commit('SET_NAME', data.name);\n          commit('SET_AVATAR', data.avatar);\n          commit('SET_INTRODUCTION', data.introduction);\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 第三方验证登录\n    // LoginByThirdparty({ commit, state }, code) {\n    //   return new Promise((resolve, reject) => {\n    //     commit('SET_CODE', code)\n    //     loginByThirdparty(state.status, state.email, state.code).then(response => {\n    //       commit('SET_TOKEN', response.data.token)\n    //       setToken(response.data.token)\n    //       resolve()\n    //     }).catch(error => {\n    //       reject(error)\n    //     })\n    //   })\n    // },\n    // 登出\n    LogOut: function LogOut(_ref3) {\n      var commit = _ref3.commit,\n          state = _ref3.state;\n      return new Promise(function (resolve, reject) {\n        (0, _login.logout)(state.token).then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_ROLES', []);\n          commit('SET_PERMS', []);\n          (0, _auth.removeToken)();\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 前端 登出\n    FedLogOut: function FedLogOut(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        (0, _auth.removeToken)();\n        resolve();\n      });\n    },\n    // 动态修改权限\n    ChangeRoles: function ChangeRoles(_ref5, role) {\n      var commit = _ref5.commit,\n          dispatch = _ref5.dispatch;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', role);\n        (0, _auth.setToken)(role);\n        (0, _login.getUserInfo)(role).then(function (response) {\n          var data = response.data;\n          commit('SET_ROLES', data.roles);\n          commit('SET_PERMS', data.perms);\n          commit('SET_NAME', data.name);\n          commit('SET_AVATAR', data.avatar);\n          commit('SET_INTRODUCTION', data.introduction);\n          dispatch('GenerateRoutes', data); // 动态修改权限后 重绘侧边菜单\n\n          resolve();\n        });\n      });\n    }\n  }\n};\nvar _default = user;\nexports.default = _default;",null]}